# 03. 技术架构与开发文档：构建现代化个人应用

## 3.1 技术栈概览 (Tech Stack)

本项目采用当前主流的前端技术栈构建，注重性能、开发体验和类型安全。

- **核心框架**: [Vue 3](https://vuejs.org/) (Composition API) - 响应式核心。
- **构建工具**: [Vite](https://vitejs.dev/) - 极速的开发服务器和打包工具。
- **语言**: [TypeScript](https://www.typescriptlang.org/) - 提供静态类型检查，增强代码健壮性。
- **状态管理**: [Pinia](https://pinia.vuejs.org/) - 轻量级、直观的状态管理库。
- **样式框架**: [Tailwind CSS](https://tailwindcss.com/) - 原子化 CSS，实现快速 UI 开发。
- **动画效果**: [AutoAnimate](https://auto-animate.formkit.com/) - 零配置的列表过渡动画。
- **拖拽交互**: [VueDraggablePlus](https://github.com/Alfred-Skyblue/vue-draggable-plus) - 基于 Sortablejs 的 Vue 3 拖拽组件。
- **AI 集成**: [DeepSeek API](https://platform.deepseek.com/) - 强大的大语言模型支持。

## 3.2 目录结构 (Project Structure)

```
web/
├── public/              # 静态资源 (Logo, Favicon)
├── src/
│   ├── assets/          # 编译期资源
│   ├── components/      # Vue 组件
│   │   ├── CanvasBlock.vue  # 单个九宫格板块组件
│   │   └── StickyNote.vue   # 便利贴组件
│   ├── store/
│   │   └── canvasStore.ts   # Pinia 状态管理 (核心数据逻辑)
│   ├── App.vue          # 根组件 (布局、AI逻辑、Markdown渲染)
│   ├── main.ts          # 入口文件
│   └── style.css        # 全局样式 (Tailwind 指令)
├── docx/                # 项目文档
├── index.html           # HTML 模板
├── package.json         # 依赖配置
├── tailwind.config.js   # Tailwind 配置
└── vite.config.ts       # Vite 配置
```

## 3.3 核心模块实现细节

### 1. 画布数据模型 (Canvas Data Model)
数据存储在 `canvasStore.ts` 中，采用扁平化结构设计。
- **CanvasBlock**: 定义了板块的元数据（标题、描述、颜色主题）和笔记列表。
- **StickyNote**: 定义了便利贴的数据结构（ID、内容、颜色、创建时间）。
- **持久化**: 使用 `localStorage` 实现数据持久化。在 `actions` 中封装了 `saveState` 方法，任何增删改查操作后自动触发保存。

### 2. AI 智能顾问集成 (AI Integration)
AI 逻辑主要集中在 `App.vue` 中。
- **上下文注入**: 在发送请求前，系统会遍历 `canvasStore` 中的所有板块内容，构建成结构化的 Prompt (提示词) 发送给 AI。这使得 AI 能够基于用户当前的画布状态提供个性化建议。
- **流式打字机效果**: 实现了 `typeMessage` 函数，通过 `setInterval` 模拟逐字输出效果，提升用户体验。
- **结构化输出解析**:
    - 为了实现“一键添加”功能，我们在 System Prompt 中强制 AI 输出特定的 JSON 格式 (`$$SUGGESTIONS_START$$...$$SUGGESTIONS_END$$`)。
    - 前端通过正则截取这部分 JSON，解析为可交互的 `Action Cards`，同时在对话框中隐藏原始 JSON 字符串。

### 3. 状态同步机制 (State Synchronization)
为了解决“刷新后按钮状态不一致”的问题，在 `App.vue` 中实现了双向绑定监听：
- **监听器**: `watch(() => store.blocks, ...)`
- **逻辑**: 当画布数据发生变化（添加/删除笔记）时，立即遍历聊天记录中的所有建议卡片。如果画布中存在内容相同的笔记，将建议卡片标记为 `isAdded = true`（置灰）；否则标记为 `false`（高亮）。
- **配置**: 使用 `immediate: true` 确保组件挂载时立即执行一次同步。

### 4. Markdown 渲染
引入 `marked` 库，配合自定义 CSS 样式，使 AI 的回答支持标题、列表、加粗等富文本格式，提升阅读体验。

## 3.4 二次开发指南

### 安装与运行
```bash
# 安装依赖
npm install

# 启动开发服务器
npm run dev

# 构建生产版本
npm run build
```

### 扩展建议
- **多画布支持**: 目前仅支持单画布。可通过修改 Store 结构，增加 `canvasId` 维度来实现多方案管理。
- **云端同步**: 对接 Firebase 或 Supabase，实现多设备同步。
- **导出 PDF**: 集成 `jspdf` 库，支持生成更正式的 PDF 报告。

## 3.5 贡献规范
- **代码风格**: 遵循 ESLint + Prettier 配置。
- **提交规范**: 使用 Conventional Commits (e.g., `feat: add export pdf feature`, `fix: button state sync`).
